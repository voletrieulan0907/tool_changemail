name: Build EXE
on:
  push:
    branches: [main]

permissions:
  contents: write
  packages: write

jobs:
  build:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-python@v5
      with:
        python-version: '3.9'
    
    - name: Install PyInstaller
      run: pip install pyinstaller
    
    - name: Build app
      run: pyinstaller --onedir --windowed --name="MyApp" app.py
    
    - name: Create folders
      run: |
        mkdir dist\MyApp\internal
        mkdir dist\MyApp\config
        mkdir dist\MyApp\data
        echo Build ${{ github.run_number }} > dist\MyApp\version.txt
      shell: cmd
    
    - name: Zip package
      run: |
        cd dist
        powershell Compress-Archive -Path MyApp -DestinationPath MyApp-v1.0.${{ github.run_number }}.zip
    
    - name: Create Release with GitHub CLI
      run: |
        gh release create "v1.0.${{ github.run_number }}" `
          --title "MyApp v1.0.${{ github.run_number }}" `
          --notes "## MyApp Build ${{ github.run_number }}

        **ğŸ“¦ Download:** MyApp-v1.0.${{ github.run_number }}.zip

        **ğŸ“ Structure:**
        - MyApp.exe (main app)
        - internal/ (your modules)
        - config/ (configuration)  
        - data/ (app data)

        **ğŸ”§ Build Info:**
        - Commit: ${{ github.sha }}
        - Build: ${{ github.run_number }}
        - Date: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" `
          --latest `
          dist/MyApp-v1.0.${{ github.run_number }}.zip
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      shell: powershell
